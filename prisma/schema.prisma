generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum role {
  superadmin
  admin
  teacher
}

enum status {
  active
  inactive
}

enum StudentStatus {
  active
  inactive
  graduated
}

enum Level {
  beginner
  intermediate
  advanced
}

enum GroupStatus {
  planned
  active
  completed
}

enum StudentGroupStatus {
  active
  inactive
  completed
}

enum AttendanceStatus {
  present
  absent
  late
}

enum PaymentMethod {
  cash
  card
  transfer
}

enum Day {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

model staffs {
  id         String   @id @default(uuid())
  first_name String
  last_name  String
  username   String   @unique
  password   String
  role       role
  position   String
  phone      String
  address    String
  hire_date  DateTime @default(now()) @db.Timestamptz(6)
  status     status   @default(active)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  groups      groups[]
  payments    Payments[]
  lessons     lessons[]
  attendances attendance[]

  @@map("staffs")
}

model students {
  id              String        @id @default(uuid())
  first_name      String
  last_name       String
  username        String        @unique
  password        String
  phone           String
  address         String
  birth_date      DateTime
  status          StudentStatus @default(active)
  enrollment_date DateTime      @default(now()) @db.Timestamptz(6)
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime      @updatedAt @db.Timestamptz(6)

  payments          Payments[]
  studentGroups     student_groups[]
  attendanceDetails attendance_details[]

  @@map("students")
}

model courses {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  duration    Int
  level       Level
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  groups groups[]

  @@map("courses")
}

model groups {
  id           String      @id @default(uuid())
  name         String      @unique
  course_id    String
  teacher_id   String
  start_date   DateTime
  end_date     DateTime
  schedule     String
  max_students Int         @default(20)
  status       GroupStatus @default(planned)
  created_at   DateTime    @default(now()) @db.Timestamptz(6)
  updated_at   DateTime    @updatedAt @db.Timestamptz(6)

  teacher       staffs           @relation(fields: [teacher_id], references: [id])
  course        courses          @relation(fields: [course_id], references: [id])
  studentGroups student_groups[]
  lessons       lessons[]
  payments      Payments[]
  schedules     Schedule[]

  @@map("groups")
}

model student_groups {
  id         String             @id @default(uuid())
  student_id String
  group_id   String
  join_date  DateTime           @default(now())
  status     StudentGroupStatus @default(active)
  created_at DateTime           @default(now()) @db.Timestamptz(6)
  updated_at DateTime           @updatedAt @db.Timestamptz(6)

  student students @relation(fields: [student_id], references: [id])
  groups  groups   @relation(fields: [group_id], references: [id])

  @@unique([student_id, group_id])
  @@map("student_groups")
}

model lessons {
  id          String   @id @default(uuid())
  group_id    String
  title       String
  description String
  lesson_date DateTime
  start_time  DateTime
  end_time    DateTime
  room_number String
  created_by  String
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  staff_id    staffs       @relation(fields: [created_by], references: [id])
  group       groups       @relation(fields: [group_id], references: [id])
  attendances attendance[]

  @@map("lessons")
}

model attendance {
  id         String   @id @default(uuid())
  created_by String
  lesson_id  String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)

  staff_id          staffs               @relation(fields: [created_by], references: [id])
  lesson            lessons              @relation(fields: [lesson_id], references: [id])
  attendanceDetails attendance_details[]

  @@map("attendance")
}

model attendance_details {
  id            String           @id @default(uuid())
  attendance_id String
  student_id    String
  status        AttendanceStatus
  comment       String

  attendance attendance @relation(fields: [attendance_id], references: [id])
  student    students   @relation(fields: [student_id], references: [id])

  @@unique([attendance_id, student_id])
  @@map("attendance_details")
}

model Payments {
  id             String        @id @default(uuid())
  student_id     String
  group_id       String
  amount         Decimal       @db.Decimal(10, 2)
  payment_date   DateTime      @default(now())
  payment_method PaymentMethod
  description    String
  receipt_number String
  created_by     String
  created_at     DateTime      @default(now()) @db.Timestamptz(6)
  updated_at     DateTime      @updatedAt @db.Timestamptz(6)

  students students @relation(fields: [student_id], references: [id])
  groups   groups   @relation(fields: [group_id], references: [id])
  staffs   staffs   @relation(fields: [created_by], references: [id])

  @@map("payments")
}

model Schedule {
  id          String   @id @default(uuid())
  group_id    String
  day         Day
  start_time  DateTime
  end_time    DateTime
  room_number String
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)


  groups groups @relation(fields: [group_id], references: [id])

  @@map("schedules")
  @@unique([group_id, day, start_time])
}
